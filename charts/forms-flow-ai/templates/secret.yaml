apiVersion: v1
kind: Secret
metadata:
  labels:
    app: "{{ .Chart.Name }}"
  name: "{{ .Chart.Name }}"
stringData:
  DATABASE_NAME: {{ ternary (tpl .Values.formsflowdb.postgresql.database .) "<DEFINE_ME>" .Values.formsflowdb.postgresql.enabled | quote }}
  DATABASE_PORT: {{ ternary .Values.formsflowdb.service.ports.postgresql "<DEFINE_ME>" .Values.formsflowdb.postgresql.enabled | quote }}
  DATABASE_SERVICE_NAME: {{ ternary (tpl .Values.formsflowdb.postgresql.fullnameOverride .) "<DEFINE_ME>" .Values.formsflowdb.postgresql.enabled | quote }}
  FORMIO_ROOT_EMAIL: {{ index .Values "forms-flow-forms" "admin" "email" }}
  FORMIO_ROOT_PASSWORD: {{ index .Values "forms-flow-forms" "admin" "password" }}
  FORMIO_JWT_SECRET: "{{ .Release.Namespace }}-jwt-secret" 
  KEYCLOAK_CLIENTID: "{{ .Values.forms_flow_bpm.clientid }}"
  KEYCLOAK_CLIENTSECRET: "{{ .Values.forms_flow_bpm.clientsecret }}"
  WEB_CLIENTID: "{{ .Values.forms_flow_web.clientid }}"
  WEBSOCKET_ENCRYPT_KEY: "{{.Values.websocket_encrypt_key}}"
  ADMIN_WEB_CLIENTID: "{{ .Values.forms_flow_web.clientid }}"
  INSIGHT_API_KEY:  "{{.Values.insight_api_key}}"
  {{- if .Values.mongodb.enabled }} 
  NODE_CONFIG: '{"mongo":"mongodb://{{ .Values.mongodb.auth.usernames | first }}:{{ .Values.mongodb.auth.passwords | first }}@{{ .Values.mongodb.service.nameOverride }}:{{ .Values.mongodb.service.ports.mongodb }}/{{ .Values.mongodb.auth.databases | first }}"}'
  MONGODB_URI:  {{ ternary (tpl "mongodb://{{ .Values.mongodb.auth.usernames | first }}:{{ .Values.mongodb.auth.passwords | first }}@{{ .Values.mongodb.service.nameOverride }}:{{ .Values.mongodb.service.ports.mongodb }}/{{ .Values.mongodb.auth.databases | first }}" .) "<DEFINE_ME>" .Values.mongodb.enabled | quote }}
  {{- else }}
  MONGODB_URI:  {{ ternary (tpl "mongodb+srv://{{ .Values.mongodb.auth.usernames | first }}:{{ .Values.mongodb.auth.passwords | first }}@{{ .Values.mongodb.service.nameOverride }}/{{ .Values.mongodb.auth.databases | first }}" .) "<DEFINE_ME>" .Values.mongodb.enabled | quote }} 
  NODE_CONFIG: '{"mongo":"mongodb+srv://{{ .Values.mongodb.auth.usernames | first }}:{{ .Values.mongodb.auth.passwords | first }}@{{ .Values.mongodb.service.nameOverride }}/{{ .Values.mongodb.auth.databases | first }}"}'
  {{- end }}

  ## forms-flow-analytics ##
  POSTGRES_HOST_AUTH_METHOD: trust
  POSTGRES_PASSWORD: postgres
  PYTHONUNBUFFERED: "0"
  REDASH_COOKIE_SECRET: "redash-selfhosted"
  REDASH_LOG_LEVEL: INFO
  REDASH_REDIS_URL: "redis://redis-exporter:6379/0" # url of the redis database to connect to
  REDASH_SECRET_KEY: "redash-selfhosted"
  REDASH_MULTI_ORG: "{{ .Values.forms_flow_analytics.redash.multiorg }}"
  REDASH_HOST: {{tpl (.Values.forms_flow_analytics.ingress.hostname) .}}
  REDASH_DATABASE_URL: {{ tpl (.Values.forms_flow_analytics.database.url) . }}
  REDASH_DATABASE_USERNAME: "{{ .Values.forms_flow_analytics.database.username }}"
  REDASH_DATABASE_PASSWORD: "{{ .Values.forms_flow_analytics.database.password }}"

  ## forms-flow-admin ##
  ADMIN_DATABASE_URL: {{ tpl (.Values.forms_flow_admin.database.url) . }}

  ## forms-flow-api ##
  IPAAS_EMBEDDED_API_KEY: "{{ .Values.ipaas.embedded_api_key }}"
  IPAAS_JWT_PRIVATE_KEY: "{{ .Values.ipaas.jwt_private_key }}"
  WEBAPI_DATABASE_URL: {{ tpl (.Values.forms_flow_api.database.url) . }}

  ## forms-flow-bpm ##
  CAMUNDA_JDBC_PASSWORD: "{{ .Values.forms_flow_bpm.camunda.jdbc.password }}"
  CAMUNDA_ANALYTICS_DATABASE_SERVICE_NAME: "{{ .Values.forms_flow_bpm.camunda.analytics.database }}"
  CAMUNDA_DATABASE_NAME: "{{ .Values.forms_flow_bpm.camunda.database.name }}"
  CAMUNDA_DATABASE_PORT: "{{ .Values.forms_flow_bpm.camunda.database.port }}"
  CAMUNDA_FORMBUILDER_PIPELINE_USERNAME: "{{ .Values.forms_flow_bpm.camunda.formBuilder.username }}"
  CAMUNDA_FORMBUILDER_PIPELINE_PASSWORD: "{{ .Values.forms_flow_bpm.camunda.formBuilder.password }}"
  CAMUNDA_JDBC_URL: {{ tpl (.Values.forms_flow_bpm.camunda.jdbc.url) . }}
  CAMUNDA_JDBC_USER: {{ tpl (.Values.forms_flow_bpm.camunda.jdbc.username) . }}
  BPM_BASE_URL: {{tpl (.Values.forms_flow_bpm.ingress.hostname) .}}
  REDIS_PASSCODE: "{{.Values.redis_pass_code}}"

  ## forms-flow-data-analysis ##
  OPENAI_API_KEY: "{{ .Values.forms_flow_data_analysis.openApiKey }}"
  CHAT_BOT_MODEL_ID: "{{ .Values.forms_flow_data_analysis.chatbotModelId }}"
---
apiVersion: v1
kind: Secret
metadata:
  labels:
    app: {{ .Chart.Name }}-auth
  name: {{ .Chart.Name }}-auth
type: kubernetes.io/dockerconfigjson
data:
  .dockerconfigjson: {{ index .Values "forms-flow-auth" "imagesecret" }}
